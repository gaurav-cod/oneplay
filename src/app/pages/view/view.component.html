<div
  *ngIf="!!game"
  class="header pb-0 pt-9"
  style="background-size: cover; background-position: center top"
  [ngStyle]="{
    'background-image': 'url(' + game.bgImage + ')'
  }"
>
  <!-- <video
    *ngIf="!!game.video"
    class="mask"
    autoplay
    loop
    [muted]="'muted'"
    [src]="game.video"
    style="height: 90%; object-fit: cover"
  ></video> -->
  <!-- Mask -->
  <span class="mask bg-gradient-banner"></span>
  <!-- Header container -->
  <div class="container-fluid">
    <div class="row container-fluid">
      <div class="col-lg-5 col-md-10 desc">
        <button
          class="btn btn-icon d-flex align-items-center p-0"
          (click)="back()"
        >
          <i class="ni ni-bold-left fill-default"></i
          ><span class="text-gray">Go back</span>
        </button>
        <img [src]="game.textLogo" class="text-logo" alt="" />
        <p class="text-white-50 mb-3">
          {{ releaseYear }} | {{ game.ageRating }}
          {{ game.isFree ? " | Free" : "" }}
        </p>
        <!-- <p class="text-white mt-0 mb-4">Play-Time: {{ game.playTime }}</p> -->
        <div
          *ngFor="let genre of game.genreMappings"
          class="badge badge-pill badge-dark text-white mr-1 mb-1"
        >
          {{ genre }}
        </div>
        <p
          id="description"
          [innerHTML]="game.description"
          class="text-white mt-3"
        ></p>
        <div
          *ngIf="game.storesMapping.length"
          class="d-flex align-items-center flex-wrap"
        >
          <span class="text-white-50 mr-3">Available purchase on:</span>
          <a
            href="{{ store.link }}"
            target="_blank"
            *ngFor="let store of game.storesMapping"
            ngbTooltip="{{ store.name }}"
            class="mr-2"
          >
            <img
              [src]="store.name | store"
              height="32"
              alt=""
              onerror="this.style.display = 'none'"
            />
          </a>
        </div>
        <div
          *ngIf="game.developer.length"
          class="d-flex align-items-center flex-wrap mt-3"
        >
          <span class="text-white-50 mr-3">Developers:</span>
          <span
            *ngFor="let dev of game.developer; let i = index"
            class="text-white mr-1"
          >
            {{ dev | titlecase
            }}<span *ngIf="i !== game.developer.length - 1">,</span></span
          >
          <!-- <a
            target="_blank"
            *ngFor="let dev of game.developer"
            ngbTooltip="{{ dev }}"
            class="mr-1"
          >
            <img
              [src]="dev | avatar"
              class="rounded-circle"
              width="32"
              height="32"
              alt=""
            />
          </a> -->
        </div>
        <!-- <p class="text-white mt-0">Available to purchase on</p>
        <a href="#!" class="btn btn-primary">Continue playing</a>
        <a href="#!" class="btn bg-translucent-dark text-white"
          >Add to wishlist</a
        > -->
      </div>
    </div>
  </div>

  <div class="pb-8 pt-5 bg-gradient-banner-bottom container-fluid buttons">
    <div class="row align-items-center container-fluid mx-auto">
      <div class="col-lg-6 col-md-12">
        <button
          *ngIf="action !== 'Terminate'"
          class="btn btn-white btn-lg w-50 position-relative"
          [disabled]="startingGame"
          (click)="playGame(smallModal)"
        >
          <ngx-ui-loader
            [fgsColor]="'#c32ead'"
            [hasProgressBar]="false"
            [fgsSize]="20"
            [fgsPosition]="'center-left'"
            [text]="'Initializing...'"
            [overlayBorderRadius]="'6px'"
            [loaderId]="'play-loader'"
          ></ngx-ui-loader>
          {{ !startingGame ? action + " Now" : "" }}
        </button>
        <button
          *ngIf="action !== 'Play'"
          class="btn btn-danger btn-lg w-25 position-relative"
          [disabled]="terminatingGame"
          (click)="terminateSession()"
        >
          <ngx-ui-loader
            [fgsColor]="'#c32ead'"
            [hasProgressBar]="false"
            [fgsSize]="20"
            [fgsPosition]="'center-left'"
            [text]="'Terminating...'"
            [overlayBorderRadius]="'6px'"
            [loaderId]="'terminate-loader'"
          ></ngx-ui-loader>
          {{ !terminatingGame ? "Terminate" : "" }}
        </button>
        <button
          *ngIf="!isInWishlist"
          (click)="addToWishlist()"
          [disabled]="loadingWishlist"
          class="btn bg-translucent-dark text-white btn-lg"
        >
          Add to wishlist
        </button>
        <button
          *ngIf="isInWishlist"
          (click)="removeFromWishlist()"
          [disabled]="loadingWishlist"
          class="btn bg-translucent-dark text-white btn-lg"
        >
          Remove from wishlist
        </button>
        <!-- <p class="text-white">Friends whoâ€™ve played this</p>
        <div class="media">
          <div class="avatar avatar-md rounded-circle mr-2">
            <img src="../../../assets/img/theme/team-1-800x800.jpg" alt="" />
          </div>
          <div class="avatar avatar-md rounded-circle mr-2">
            <img src="../../../assets/img/theme/team-2-800x800.jpg" alt="" />
          </div>
          <div class="avatar avatar-md rounded-circle">
            <img src="../../../assets/img/theme/team-3-800x800.jpg" alt="" />
          </div>
        </div> -->
      </div>
    </div>
    <div class="container-fluid">
      <div class="custom-control custom-checkbox my-4">
        <input
          type="checkbox"
          class="custom-control-input"
          id="customCheck1"
          [formControl]="showSettings"
        />
        <label class="custom-control-label text-white" for="customCheck1">
          Show gameplay settings before launch
        </label>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid">
  <div *ngIf="!!game" class="container-fluid pb-6">
    <div class="row">
      <div class="col-md-6 col-12">
        <h2 class="text-white mb-4">Top Videos</h2>
        <p *ngIf="videos.length === 0" class="text-white-50 text-center">
          No videos found
        </p>
        <div
          *ngFor="let video of videos"
          class="card bg-dark p-3 mb-3"
          (click)="open(modal, video)"
          style="cursor: pointer; box-shadow: 6px 5px 4px 2px #0e0d0d"
        >
          <div class="media flex-column flex-md-row">
            <img
              [src]="video.thumbnail"
              (click)="open(modal, video)"
              class="video-image"
              alt=""
            />
            <div class="ml-3 mt-3 mt-md-0">
              <h3 class="text-white video-text two-lines">
                {{ video.title }}
              </h3>
              <div class="media mb-1 align-items-center">
                <img
                  [src]="
                    !!video.creatorThumbnail
                      ? video.creatorThumbnail
                      : (video.creatorName | avatar)
                  "
                  class="rounded-circle"
                  width="24"
                  height="24"
                  alt=""
                />
                <span class="text-white-50 small ml-1">{{
                  video.creatorName
                }}</span>
              </div>
              <div class="text-white">
                <span class="text-xs video-text three-lines-xs">{{
                  video.description
                }}</span>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="videos.length >= 3" class="text-center p-3">
          <button
            class="btn btn-outline-success btn-sm"
            (click)="showAllVideos = !showAllVideos"
          >
            {{ showAllVideos ? "Show Less" : "Show All" }}
          </button>
        </div>
      </div>
      <div class="col-md-6 col-12 pr-lg-4">
        <h2 class="text-white mb-4">Top Live Streams</h2>
        <p *ngIf="liveVideos.length === 0" class="text-white-50 text-center">
          No videos found
        </p>
        <div
          *ngFor="let video of liveVideos"
          class="card bg-dark p-3 mb-3"
          (click)="open(modal, video)"
          style="cursor: pointer; box-shadow: 6px 5px 4px 2px #0e0d0d"
        >
          <div class="media flex-column flex-md-row">
            <img
              [src]="video.thumbnail"
              (click)="open(modal, video)"
              style="border-radius: 4px"
              class="video-image"
              alt=""
            />
            <live>LIVE</live>
            <div class="ml-3 mt-3 mt-md-0">
              <h3 class="text-white video-text two-lines">
                {{ video.title }}
              </h3>
              <div class="media mb-1 align-items-center">
                <img
                  [src]="
                    !!video.creatorThumbnail || (video.creatorName | avatar)
                  "
                  class="rounded-circle"
                  width="24"
                  height="24"
                  alt=""
                />
                <span class="text-white-50 small ml-1">{{
                  video.creatorName
                }}</span>
              </div>
              <div class="text-white">
                <span class="text-xs video-text three-lines-xs">{{
                  video.description
                }}</span>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="liveVideos.length >= 3" class="text-center p-3">
          <button
            class="btn btn-outline-success btn-sm"
            (click)="showAllLiveVideos = !showAllLiveVideos"
          >
            {{ showAllLiveVideos ? "Show Less" : "Show All" }}
          </button>
        </div>
      </div>
    </div>

    <div *ngIf="similarGames.length" class="mt-6">
      <app-similar-games
        [title]="'Similar games'"
        [games]="similarGames"
      ></app-similar-games>
    </div>

    <div *ngIf="genreGames.length" class="mt-5">
      <app-similar-games
        [title]="allGenres"
        [games]="genreGames"
      ></app-similar-games>
    </div>

    <div *ngIf="devGames.length" class="mt-5">
      <app-similar-games
        [title]="allDevelopers"
        [games]="devGames"
      ></app-similar-games>
    </div>
  </div>
</div>

<ng-template #modal let-d="dismiss">
  <div class="modal-content position-relative">
    <div
      class="position-absolute btn btn-github rounded-circle top--4 right--6 py-3"
      (click)="d('Cross click')"
    >
      <i class="fas fa-times"></i>
    </div>
    <iframe
      class="youtube-player"
      [src]="playing | safe"
      title="YouTube video player"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen
    ></iframe>
  </div>
</ng-template>

<!-- small modal to select resolution, vsync and fps before launching the game -->
<ng-template #smallModal let-d="dismiss">
  <div class="modal-content position-relative">
    <div
      class="position-absolute btn btn-github rounded-circle top--4 right--6 py-3"
      (click)="d('Cross click')"
    >
      <i class="fas fa-times"></i>
    </div>
    <div class="modal-body">
      <div class="row">
        <div class="col-12">
          <h2 class="text-dark mb-4">Select your game settings</h2>
        </div>
      </div>
      <div class="row">
        <div *ngIf="game.storesMapping.length" class="col-12">
          <div class="alert alert-dark" role="alert">
            <i class="fa fa-gamepad text-danger"></i>
            <span class="ml-2">
              You need to
              {{ game.isFree ? "have account" : "purchase this game" }} in
              {{ game.storesMapping.length > 1 ? "any of" : "" }}
              <a
                *ngFor="let store of game.storesMapping"
                [href]="store.link"
                target="_blank"
                class="d-inline-block mx-1 text-danger"
                >{{ store.name }}</a
              >
              to play this game
            </span>
          </div>
        </div>
        <div class="col-12">
          <div class="alert alert-success" role="alert">
            <i class="fa fa-download text-primary"></i>
            <span class="ml-2">
              You need to
              <a
                href="https://www.oneplay.in/download.html"
                target="_blank"
                class="d-inline-block mx-1"
              >
                download & install
              </a>
              the OnePlay client to play this game
            </span>
          </div>
        </div>
        <div class="col-12 col-md-6">
          <div class="form-group">
            <label for="resolution" class="text-dark"> Resolution </label>
            <select
              class="form-control"
              id="resolution"
              [formControl]="resolution"
            >
              <option
                *ngFor="let res of constants.RESOLUTIONS"
                [value]="res"
                [disabled]="!allowedResolutions.includes(res)"
              >
                {{ res }}
              </option>
              <option
                [value]="deviceResolution"
                [disabled]="!allowAutoResolution"
              >
                Your screen resolution
              </option>
            </select>
          </div>
        </div>
        <div class="col-12 col-md-6">
          <div class="form-group">
            <label for="vsync" class="text-dark">Vsync</label>
            <select class="form-control" id="vsync" [formControl]="vsync">
              <option *ngFor="let v of constants.VSYNC" [value]="v.value">
                {{ v.label }}
              </option>
            </select>
          </div>
        </div>
        <div class="col-12 col-md-6">
          <div class="form-group">
            <label for="fps" class="text-dark">FPS</label>
            <select class="form-control" id="fps" [formControl]="fps">
              <option *ngFor="let f of constants.FPS" [value]="f">
                {{ f }}
              </option>
            </select>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-12 mb-2">
          <button
            class="btn btn-link btn-block"
            (click)="openAdvanceOptions(advanced)"
          >
            Advanced Options
            <i class="fas fa-external-link-alt ml-2"></i>
          </button>
        </div>
        <div class="col-12">
          <button class="btn btn-primary btn-block" (click)="startGame()">
            Launch game
          </button>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #initializedModal>
  <div class="modal-content" [ngStyle]="{ display: display }">
    <div class="modal-body pl-4 pr-4 pt-4 pb-0 text-center">
      <h2 class="text-dark mb-2">{{ initialized }}</h2>
      <p class="text-muted mb-0">
        Please wait while we connect you to the game
      </p>
      <!-- <ngx-ui-loader
        [fgsColor]="'#c32ead'"
        [hasProgressBar]="false"
        [fgsSize]="20"
        [fgsPosition]="'center-left'"
        [text]="'Initializing...'"
        [overlayBorderRadius]="'6px'"
        [loaderId]="'initialize-loader'"
      ></ngx-ui-loader> -->
      <img
        src="https://miro.medium.com/max/1400/1*CsJ05WEGfunYMLGfsT2sXA.gif"
        width="300px"
      />
    </div>
  </div>
</ng-template>

<ng-template #advanced let-d="dismiss">
  <div class="modal-content position-relative">
    <form [formGroup]="advancedOptions" class="modal-body">
      <div class="form-group custom-control custom-switch">
        <input
          id="mouse_mode"
          type="checkbox"
          class="custom-control-input"
          formControlName="absolute_mouse_mode"
        />
        <label class="custom-control-label" for="mouse_mode"
          >Absolute Mouse Mode</label
        >
      </div>
      <div class="form-group custom-control custom-switch">
        <input
          id="touch_mode"
          type="checkbox"
          class="custom-control-input"
          formControlName="absolute_touch_mode"
        />
        <label class="custom-control-label" for="touch_mode"
          >Absolute Touch Mode</label
        >
      </div>
      <div class="form-group custom-control custom-switch">
        <input
          id="background_gamepad"
          type="checkbox"
          class="custom-control-input"
          formControlName="background_gamepad"
        />
        <label class="custom-control-label" for="background_gamepad"
          >Background Gamepad</label
        >
      </div>
      <div class="form-group row">
        <label class="col-12 col-md-4">Audio Type:</label>
        <div class="col-12 col-md-8">
          <select
            formControlName="audio_type"
            class="form-control form-control-sm"
          >
            <option value="stereo">Stereo</option>
            <option value="5_1">5.1</option>
          </select>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-12 col-md-5">Stream Codec:</label>
        <div class="col-12 col-md-7">
          <select
            formControlName="stream_codec"
            class="form-control form-control-sm"
          >
            <option value="auto">Auto</option>
            <option value="forceh265">HEVC</option>
            <option value="neverh265">H.265</option>
          </select>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-12 col-md-7">Video Decoder Selection:</label>
        <div class="col-12 col-md-5">
          <select
            formControlName="video_decoder_selection"
            class="form-control form-control-sm"
          >
            <option value="auto">Auto</option>
            <option value="software">Software</option>
            <option value="hardware">Hardware</option>
          </select>
        </div>
      </div>
    </form>
    <div class="modal-footer">
      <button class="btn btn-primary" (click)="d('dismiss')">OK</button>
    </div>
  </div>
</ng-template>

<ngx-ui-loader [fgsColor]="'#c32ead'"></ngx-ui-loader>
